---
# yaml-language-server: $schema=https://json.schemastore.org/kustomization
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: flux-system

resources:
  - github.com/fluxcd/flux2/manifests/install?ref=v2.2.2

patches:
  # Disable the network policies
  - patch: |
      $patch: delete
      apiVersion: networking.k8s.io/v1
      kind: NetworkPolicy
      metadata:
        name: not-used
    target:
      group: networking.k8s.io
      kind: NetworkPolicy

  # Disable image-reflector and image-automation controllers
  - patch: |
      $patch: delete
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: not-used
    target:
      kind: Deployment
      name: (image-reflector-controller|image-automation-controller)
