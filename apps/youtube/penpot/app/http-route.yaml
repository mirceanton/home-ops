---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: penpot
spec:
  hostnames:
    - "penpot.home.mirceanton.com"
  parentRefs:
    - name: envoy-internal
      namespace: network-system
  rules:
    # Export API -> exporter service
    - matches:
        - path:
            type: PathPrefix
            value: /api/export
      backendRefs:
        - name: penpot-exporter
          port: 6061

    # API endpoints -> backend service
    - matches:
        - path:
            type: PathPrefix
            value: /api
      backendRefs:
        - name: penpot-backend
          port: 6060

    # Assets -> backend service
    - matches:
        - path:
            type: PathPrefix
            value: /assets
      backendRefs:
        - name: penpot-backend
          port: 6060

    # Webhooks -> backend service
    - matches:
        - path:
            type: PathPrefix
            value: /webhooks
      backendRefs:
        - name: penpot-backend
          port: 6060

    # WebSocket notifications -> backend service
    - matches:
        - path:
            type: PathPrefix
            value: /ws/notifications
      backendRefs:
        - name: penpot-backend
          port: 6060

    # Everything else -> frontend service
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: penpot
          port: 8080
