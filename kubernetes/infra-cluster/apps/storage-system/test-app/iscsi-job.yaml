---
apiVersion: batch/v1
kind: Job
metadata:
  name: fio-job-iscsi
spec:
  template:
    spec:
      restartPolicy: Never
      volumes:
        - name: test-volume
          iscsi:
            targetPortal: 10.0.10.245:3260
            iqn: iqn.2023-04.com.mirceanton.iscsi:truenas:infra-cluster-minio
            lun: 0
            fsType: ext4
            readOnly: false
      containers:
        - name: fio
          image: nixery.dev/shell/fio
          args:
            - fio
            - --name=benchtest
            - --size=800m
            - --filename=/volume/test
            - --direct=1
            - --rw=randrw
            - --ioengine=libaio
            - --bs=4k
            - --iodepth=16
            - --numjobs=8
            - --time_based
            - --runtime=60
          volumeMounts:
            - mountPath: "/volume"
              name: test-volume
