---
# yaml-language-server: $schema=https://kubernetes-schemas.devbu.io/helm.toolkit.fluxcd.io/helmrelease_v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: minio
spec:
  chart:
    spec:
      chart: minio
      version: 12.8.15
      sourceRef:
        kind: HelmRepository
        name: bitnami

  values:
    ## @section Global parameters
    global:
      imageRegistry: ""
      imagePullSecrets: []
      storageClass: ""

    ## @section MinIO parameters
    image:
      repository: bitnami/minio
      # tag: 2023.10.16-debian-11-r0
      # digest: ""

    clientImage:
      repository: bitnami/minio-client
      # tag: 2023.10.14-debian-11-r0
      # digest: ""

    ## @param mode MinIO server mode (`standalone` or `distributed`)
    ## ref: https://docs.minio.io/docs/distributed-minio-quickstart-guide
    mode: standalone

    ## MinIO&reg; authentication parameters
    auth:
      rootUser: admin
      existingSecret: ""

    ## @param defaultBuckets Comma, semi-colon or space separated list of buckets to create at initialization (only in standalone mode)
    defaultBuckets: "home-cluster-velero"

    ## @param disableWebUI Disable MinIO&reg; Web UI
    ## ref: https://github.com/minio/minio/tree/master/docs/config/#browser
    disableWebUI: false

    ## Enable tls in front of MinIO&reg; containers.
    tls:
      enabled: false

    deployment:
      updateStrategy:
        type: Recreate

    ## MinIO&reg; provisioning
    provisioning:
      enabled: false

    resources:
      limits:
        cpu: 4
        memory: 6Gi
      requests:
        cpu: 1
        memory: 1Gi

    ## @section Traffic exposure parameters
    ## MinIO Service properties
    service:
      type: ClusterIP
      ports:
        api: 9000
        console: 9001

    ## Configure the ingress resource that allows you to access the
    ## MinIO Console. Set up the URL
    ## ref: https://kubernetes.io/docs/user-guide/ingress/
    ingress:
      enabled: true
      ingressClassName: nginx
      hostname: minio.${CLUSTER_DOMAIN}
      path: /
      pathType: ImplementationSpecific
      servicePort: minio-console

    ## Configure the ingress resource that allows you to access the
    ## MinIO API. Set up the URL
    ## ref: https://kubernetes.io/docs/user-guide/ingress/
    ##
    apiIngress:
      enabled: true
      ingressClassName: nginx
      hostname: minio-api.${CLUSTER_DOMAIN}
      path: /
      pathType: ImplementationSpecific
      servicePort: minio-api


    ## NetworkPolicy parameters
    networkPolicy:
      enabled: false


    ## @section Persistence parameters
    ## ref: https://kubernetes.io/docs/user-guide/persistent-volumes/
    persistence:
      enabled: true
      mountPath: /bitnami/minio/data
      accessModes: [ ReadWriteOnce ]
      size: 20Gi
      annotations: {}

    ## @section Volume Permissions parameters
    volumePermissions:
      enabled: false

    ## RBAC parameters
    serviceAccount:
      create: true
      automountServiceAccountToken: true


    ## Pod Disruption Budget configuration -- only for distributed mode.
    pdb:
      create: false

    ## Metrics parameters
    metrics:
      serviceMonitor:
        enabled: false
      ## Prometheus Operator PrometheusRule configuration
      prometheusRule:
        enabled: false