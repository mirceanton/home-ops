---
# yaml-language-server: $schema=https://kubernetes-schemas.devbu.io/helm.toolkit.fluxcd.io/helmrelease_v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: minio
spec:
  chart:
    spec:
      chart: minio
      version: 8.0.10
      sourceRef:
        kind: HelmRepository
        name: minio

  values:
    ## ================================================================================================
    ## Images configurations
    ## ================================================================================================
    imagePullSecrets: []

    image:
      repository: minio/minio
      tag: RELEASE.2021-02-14T04-01-33Z
      pullPolicy: IfNotPresent

    ## Set default image, imageTag, and imagePullPolicy for the `mc` (the minio
    ## client used to create a default bucket).
    mcImage:
      repository: minio/mc
      tag: RELEASE.2021-02-14T04-28-06Z
      pullPolicy: IfNotPresent

    ## Set default image, imageTag, and imagePullPolicy for the `jq` (the JSON
    ## process used to create secret for prometheus ServiceMonitor).
    helmKubectlJqImage:
      repository: bskim45/helm-kubectl-jq
      tag: 3.1.0
      pullPolicy: IfNotPresent

    ## ================================================================================================
    ## MinIO Deployment Settings
    ## ================================================================================================
    ## minio server mode, i.e. standalone or distributed.
    ## Distributed Minio ref: https://docs.minio.io/docs/distributed-minio-quickstart-guide
    mode: standalone

    ## Configure resource requests and limits
    ## ref: http://kubernetes.io/docs/user-guide/compute-resources/
    resources:
      requests:
        memory: 4Gi
      limits:
        memory: 8Gi

    ## Expose the Minio service to be accessed from outside the cluster (LoadBalancer service).
    ## or access it from within the cluster (ClusterIP service). Set the service type and the port to serve it.
    ## ref: http://kubernetes.io/docs/user-guide/services/
    service:
      type: ClusterIP
      clusterIP: ~
      port: 9000
      nodePort: 32000
      externalIPs: []
      annotations: {}


    ## ================================================================================================
    ## Persistence
    ## ref: http://kubernetes.io/docs/user-guide/persistent-volumes/
    ## ================================================================================================
    persistence:
      enabled: true
      storageClass: ""
      accessMode: ReadWriteOnce
      size: 50Gi


    ## ================================================================================================
    ## Ingress
    ## ref: https://kubernetes.io/docs/concepts/services-networking/ingress/
    ## ================================================================================================
    ingress:
      enabled: true
      path: /
      hosts:
        - minio.${CLUSTER_DOMAIN}
      tls: []

    ## TLS Settings for Minio
    tls:
      enabled: false


    ## ================================================================================================
    ## Bucket Creation
    ## ================================================================================================
    defaultBucket:
      enabled: false

    buckets:
      - name: home-cluster-backup
        policy: none

    makeBucketJob:
      podAnnotations:
      annotations:
      securityContext:
        enabled: false
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
      resources:
        requests:
          memory: 128Mi


    ## ================================================================================================
    ## Network Policies
    ## ================================================================================================
    networkPolicy:
      enabled: false
      allowExternal: true


    ## ================================================================================================
    ## Service Account
    ## ================================================================================================
    serviceAccount:
      create: true


    ## ================================================================================================
    ## Monitoring
    ## ================================================================================================
    metrics:
      serviceMonitor:
        enabled: false
