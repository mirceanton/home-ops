---
# yaml-language-server: $schema=https://raw.githubusercontent.com/fluxcd-community/flux2-schemas/main/helmrelease-helm-v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: local-path-provisioner
spec:
  chart:
    spec:
      chart: ./deploy/chart/local-path-provisioner
      sourceRef:
        kind: GitRepository
        name: local-path-provisioner

  values:
    replicaCount: 1

    image:
      repository: rancher/local-path-provisioner
      tag: v0.0.24
      pullPolicy: IfNotPresent

    helperImage:
      repository: busybox
      tag: latest

    imagePullSecrets: []

    ## For creating the StorageClass automatically:
    storageClass:
      create: true
      provisionerName: rancher.io/local-path
      defaultClass: true
      name: local-path
      reclaimPolicy: Delete

    nodePathMap:
      - node: DEFAULT_PATH_FOR_NON_LISTED_NODES
        paths: [ /var/mnt/local-path-provisioner ]

    resources:
      limits:
        cpu: 250m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi

    nodeSelector: {}
    affinity: {}
    tolerations: []

    # Number of provisioner worker threads to call provision/delete simultaneously.
    workerThreads: "'4'"

    # Number of retries of failed volume provisioning. 0 means retry indefinitely.
    provisioningRetryCount: "'15'"

    # Number of retries of failed volume deletion. 0 means retry indefinitely.
    deletionRetryCount: "'15'"
