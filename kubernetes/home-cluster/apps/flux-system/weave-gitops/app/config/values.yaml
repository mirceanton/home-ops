---
logLevel: info

imagePullSecrets: []

# -- Specifies whether default network policies should be created.
networkPolicy:
  create: true


## ================================================================================================
## WEAVE GITOPS DEPLOYMENT PARAMTERS
## ================================================================================================
replicaCount: 2
image:
  repository: ghcr.io/weaveworks/wego-app
  pullPolicy: IfNotPresent

envVars:
  - name: WEAVE_GITOPS_FEATURE_TENANCY
    value: "true"
  - name: WEAVE_GITOPS_FEATURE_CLUSTER
    value: "false"

resources:
  limits:
    cpu: 1000m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

nodeSelector: {}
affinity: {}
tolerations: []

podAnnotations:
  # annotate pod to be re-created if the auth secret changes
  secret.reloader.stakater.com/reload: cluster-user-auth


# Should the 'oidc-auth' secret be created. For a detailed
# explanation of these attributes please see our documentation:
# https://docs.gitops.weave.works/docs/configuration/securing-access-to-the-dashboard/#login-via-an-oidc-provider
oidcSecret:
  create: false
  # clientID:
  # clientSecret:
  # issuerURL:
  # redirectURL


## ================================================================================================
## ROLE BASED ACCESS CONTROL
## ================================================================================================
rbac:
  create: true

  # -- If non-empty, this limits the resources that the service
  impersonationResourceNames: []

  # -- Limit the type of principal that can be impersonated
  impersonationResources: ["users", "groups"]

  # -- If non-empty, this limits the secrets that can be accessed by
  # the service account to the specified ones, e.g. `['weave-gitops-enterprise-credentials']`
  viewSecretsResourceNames: ["cluster-user-auth", "oidc-auth"]

  # -- If non-empty, these additional rules will be appended to the RBAC role and the cluster role.
  additionalRules:
    - apiGroups: [ "infra.contrib.fluxcd.io" ]
      resources: [ "terraforms" ]
      verbs: [ "get", "list", "patch" ]


## ================================================================================================
## ADMINISTRATIVE USER
## ================================================================================================
adminUser:
  create: true
  createClusterRole: true
  createSecret: false
  username: ${WEAVE_ADMIN_USER}
  passwordHash: ${WEAVE_ADMIN_PASS}


## ================================================================================================
## INGRESS
## ================================================================================================
ingress:
  enabled: true
  className: nginx
  hosts:
    - host: weave.admin.${CLUSTER_DOMAIN}
      paths:
        - path: /
          pathType: Prefix
  tls: []


## ================================================================================================
## MONITORING
## ================================================================================================
metrics:
  enabled: true
  service:
    port: 2112
    annotations:
      prometheus.io/scrape: "true"
      prometheus.io/path: "/metrics"
      prometheus.io/port: "2112"  #!! must match metrics.service.port
