---
apiVersion: infra.contrib.fluxcd.io/v1alpha2
kind: Terraform
metadata:
  name: cloudflare
spec:
  interval: 1h
  approvePlan: auto
  backendConfig:
    disable: true

  path: infra/cloudflare
  sourceRef:
    kind: GitRepository
    name: home-ops-git-repo
    namespace: flux-system

  runnerPodTemplate:
    spec:
      env:
        - name: TF_TOKEN_app_terraform_io
          valueFrom:
            secretKeyRef:
              name: terraform-cloud-token
              key: token

  vars:
    - name: cluster_domain
      value: ${CLUSTER_DOMAIN}

  varsFrom:
    - kind: Secret
      name: cloudflare-credentials
    - kind: Secret
      name: cloudflare-config
