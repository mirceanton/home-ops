---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: reloader
spec:
  chart:
    spec:
      chart: reloader
      version: 1.0.41
      sourceRef:
        kind: HelmRepository
        name: stakater

  values:
    fullnameOverride: reloader
    reloader:
      enableHA: true

      deployment:
        replicas: 2

        # Prevent 2 instances from being scheduled on the same node
        topologySpreadConstraints:
          - maxSkew: 1
            topologyKey: kubernetes.io/hostname
            whenUnsatisfiable: DoNotSchedule
            labelSelector:
              matchLabels:
                app: reloader-reloader
