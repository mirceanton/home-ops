---
version: '3'

env:
  CLUSTER_NAME: home-cluster
  CLUSTER_ENDPOINT: 10.0.10.10
  KUBERNETES_VERSION: 1.28.2

includes:
  tools: .taskfiles/tools.yaml
  sops: .taskfiles/sops.yaml
  docs: .taskfiles/docs.yaml
  talos:
    taskfile: .taskfiles/talos.yaml
    dir: infra/home-cluster/talos
  k8s:
    taskfile: .taskfiles/k8s.yaml
    dir: infra/home-cluster/kubernetes

tasks:
  default:
    silent: true
    cmds:
      - task -l

  delete-stuck-ns:
    description: Delete all namespaces stuck in "terminating" state.
    cmds:
      - bash {{.ROOT_DIR}}/scripts/delete-stuck-ns.sh

  cluster:
    description: End to end Kubernetes cluster bootstrap
    cmds:
      - task: talos:generate-config
      - task: talos:apply-config
      - task: talos:talosconfig
      - task: talos:wait
      - task: k8s:bootstrap
      - task: k8s:kubeconfig
      - task: k8s:wait
