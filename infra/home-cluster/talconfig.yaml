---
# yaml-language-server: $schema=https://raw.githubusercontent.com/budimanjojo/talhelper/master/pkg/config/schemas/talconfig.json
clusterName: ${clusterName}
endpoint: https://${clusterName}.${clusterNetworkDomain}:6443

# renovate: datasource=github-releases depName=siderolabs/talos
talosVersion: v1.5.5

# renovate: datasource=github-releases depName=kubernetes/kubernetes
kubernetesVersion: v1.28.4

domain: cluster.local
allowSchedulingOnControlPlanes: true
additionalApiServerCertSans:
  - ${clusterEndpointIP}
additionalMachineCertSans:
  - ${clusterEndpointIP}
  - ${clusterName}.${clusterNetworkDomain}

patches:
  - "@patches/cni.yaml"
  - "@patches/kubelet-certificate-rotation.yaml"

worker:
  patches: []

controlPlane:
  patches:
    - "@patches/keycloak-auth.yaml"

nodes:
  - hostname: nuc.${clusterName}.${clusterNetworkDomain}
    ipAddress: 10.0.10.11
    installDisk: /dev/nvme0n1
    controlPlane: true
    networkInterfaces:
      - interface: enp100s0
        dhcp: true
        vip:
          ip: ${clusterEndpointIP}
    schematic:
      customization:
        systemExtensions:
          officialExtensions:
            - siderolabs/i915-ucode
            - siderolabs/intel-ucode
            - siderolabs/iscsi-tools

  - hostname: srv.${clusterName}.${clusterNetworkDomain}
    ipAddress: 10.0.10.12
    installDisk: /dev/nvme0n1
    controlPlane: true
    networkInterfaces:
      - interface: enp2s0
        dhcp: true
        vip:
          ip: ${clusterEndpointIP}
    schematic:
      customization:
        systemExtensions:
          officialExtensions:
            - siderolabs/i915-ucode
            - siderolabs/intel-ucode
            - siderolabs/iscsi-tools

  - hostname: minisforum.${clusterName}.${clusterNetworkDomain}
    ipAddress: 10.0.10.13
    installDisk: /dev/nvme0n1
    controlPlane: true
    networkInterfaces:
      - interface: enp0s31f6
        dhcp: true
        vip:
          ip: ${clusterEndpointIP}
    schematic:
      customization:
        systemExtensions:
          officialExtensions:
            - siderolabs/amd-ucode
            - siderolabs/iscsi-tools
